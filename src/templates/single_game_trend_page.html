{% extends 'base.html' %}

{% block head %}
    <title>NFL Betting Trends</title>
{% endblock %}

{% block body %}
<div class="content">
    <!-- Title -->
    <a href="/"><h1>NFL Betting Trends</h1></a>
    
    <!-- Games Table -->
    <div class="games">
        <table>
            <tr>
                <th>Date</th>
                <th>Team</th>
                <th>Spread</th>
                <th>Moneyline</th>
                <th>Total</th>
            </tr>
            <!-- Game Data -->
            <tr>
                <td>{{ game.date }}</td>
                <td>{{ game.away_team }}</td>
                <td>
                    {{ game.away_spread }}
                    <br>
                    {{ game.away_spread_odds }}
                </td>
                <td>
                    {% if game.away_moneyline_odds > 0 %}
                        +{{ game.away_moneyline_odds }}
                    {% else %}
                        {{ game.away_moneyline_odds }}
                    {% endif %}
                </td>
                <td>
                    u{{ game.under }}
                    <br>
                    {{ game.under_odds }}
                </td>
            </tr>
            <!-- Home Team -->
            <tr>
                <td></td>
                <td>{{ game.home_team }}</td>
                <td>
                    {{ game.home_spread }}
                    <br>
                    {{ game.home_spread_odds }}
                </td>
                <td>
                    {% if game.home_moneyline_odds > 0 %}
                        +{{ game.home_moneyline_odds }}
                    {% else %}
                        {{ game.home_moneyline_odds }}
                    {% endif %}
                </td>
                <td>
                    o{{ game.over }}
                    <br>
                    {{ game.over_odds }}
                </td>
            </tr>
        </table>
    </div>
    
    <!-- Filters -->
    <div class="filters">
        <h3>Filters</h3>
        <form action="/{{ game.id }}" method="POST">
            <!-- Specific Trend Categories -->
            <strong>Specific Trend Categories</strong><br>
            <!-- Home/Away -->
            <label><input type="checkbox" name="home" value="true" {% if filters['home'] == 'true' %} checked {% endif %}> Home</label>
            <input type="hidden" name="home" value="false">
            <label><input type="checkbox" name="away" value="true" {% if filters['away'] == 'true' %} checked {% endif %}> Away</label>
            <input type="hidden" name="away" value="false">
            <!-- Favorite/Underdog -->
            {% if game.spread != 0 %}
                <label><input type="checkbox" name="favorite" value="true" {% if filters['favorite'] == 'true' %} checked {% endif %}> Favorite</label>
                <input type="hidden" name="favorite" value="false">
                <label><input type="checkbox" name="underdog" value="true" {% if filters['underdog'] == 'true' %} checked {% endif %}> Underdog</label>
                <input type="hidden" name="underdog" value="false">
                <!-- Home/Away Favorite/Underdog -->
                {% if game.home_spread < 0 %}
                    <label><input type="checkbox" name="home_favorite" value="true" {% if filters['home favorite'] == 'true' %} checked {% endif %}> Home Favorite</label>
                    <input type="hidden" name="home_favorite" value="false">
                    <label><input type="checkbox" name="away_underdog" value="true" {% if filters['away underdog'] == 'true' %} checked {% endif %}> Away Underdog</label>
                    <input type="hidden" name="away_underdog" value="false">
                {% else %}
                    <label><input type="checkbox" name="away_favorite" value="true" {% if filters['away favorite'] == 'true' %} checked {% endif %}> Away Favorite</label>
                    <input type="hidden" name="away_favorite" value="false">
                    <label><input type="checkbox" name="home_underdog" value="true" {% if filters['home underdog'] == 'true' %} checked {% endif %}> Home Underdog</label>
                    <input type="hidden" name="home_underdog" value="false">
                {% endif %}
            {% endif %}
            <!-- Over/Under -->
            <label><input type="checkbox" name="over" value="true" {% if filters['over'] == 'true' %} checked {% endif %}> Over</label>
            <input type="hidden" name="over" value="false">
            <label><input type="checkbox" name="under" value="true" {% if filters['under'] == 'true' %} checked {% endif %}> Under</label>
            <input type="hidden" name="under" value="false">
            <br>
            <!-- Specific Betting Categories -->
            <strong>Specific Betting Categories</strong><br>
            <label><input type="checkbox" name="ats" value="true" {% if filters['ats'] == 'true' %} checked {% endif %}> Against the Spread</label>
            <input type="hidden" name="ats" value="false">
            <label><input type="checkbox" name="outright" value="true" {% if filters['outright'] == 'true' %} checked {% endif %}> Outright</label>
            <input type="hidden" name="outright" value="false">
            <br><br>
            <!-- Month -->
            <strong>Month<br></strong>
            <label><input type="checkbox" name="game_month" value="true" {% if filters['game_month'] == 'true' %} checked {% endif %}> Only Games in {{ game.month }}</label>
            <input type="hidden" name="game_month" value="false">
            <br>
            <!-- Day -->
            <strong>Day<br></strong>
            <label><input type="checkbox" name="game_day" value="true" {% if filters['game_day'] == 'true' %} checked {% endif %}> Only Games on {{ game.day_of_week }}s</label>
            <input type="hidden" name="game_day" value="false">
            <br>
            <!-- Game Type -->
            <strong>Game Type<br></strong>
            <input type="checkbox" name="divisional" value="true" {% if filters['divisional'] == 'true' %} checked {% endif %}>
            <label for="divisional">Only
                {% if game.divisional == False %}
                    Non
                {% endif %}
                Divisional Games
            </label>
            <input type="hidden" name="divisional" value="false">
            <br>
            <!-- Spread -->
            <strong><label for="spread">Spread</label></strong>
            <br>
            <!-- Spread Options -->
            {% set spread_integer = game.spread|int %}
            <!-- Individual Spread Options -->
            <label><input type="checkbox" class="spread-options" name="spread {{ game.spread }}" value="true" {% if filters['spread ' ~ game.spread|string] == 'true' %} checked {% endif %}> {{ game.spread }}</label>
            <input type="hidden" name="spread {{ game.spread }}" value="false">
            <br>
            <!-- Spread Ranges -->
            {% set ceiling_spread = spread_integer if spread_integer == game.spread else spread_integer + 1 %}
            {% set floor_spread = spread_integer %}
            {% for i in range(1, floor_spread + 1) %}
                {% set more_str = 'spread ' ~ i ~ ' or more' %}
                <label><input type="checkbox" class="spread-options" name="{{ more_str }}" value="true" {% if filters[more_str] == 'true' %} checked {% endif %}> {{i}} or more</label>
                <input type="hidden" name="{{ more_str }}" value="false">
            {% endfor %}
            <br>
            {% for i in range(ceiling_spread, 15) %}
                {% set less_str = 'spread ' ~ i ~ ' or less' %}
                <label><input type="checkbox" class="spread-options" name="{{ less_str }}" value="true" {% if filters[less_str] == 'true' %} checked {% endif %}> {{i}} or less</label>
                <input type="hidden" name="{{ less_str }}" value="false">                
            {% endfor %}
            <br>
            <!-- Total -->
            <strong><label for="total">Total</label></strong>
            <br>
            <!-- Total Options -->
            {% set total_integer = game.total|int %}
            {% set floor_total = (total_integer // 5) * 5 %}
            {% set ceiling_total = ((total_integer + 4) // 5) * 5 %}
            {% for i in range(30, floor_total + 1, 5) %}
                {% set more_str = 'total ' ~ i ~ ' or more' %}
                <label><input type="checkbox" class="total-options" name="{{ more_str }}" value="true" {% if filters[more_str] == 'true' %} checked {% endif %}> {{i}} or more</label>
                <input type="hidden" name="{{ more_str }}" value="false">
            {% endfor %}
            <br>
            {% for i in range(ceiling_total, 61, 5) %}
                {% set less_str = 'total ' ~ i ~ ' or less' %}
                <label><input type="checkbox" class="total-options" name="{{ less_str }}" value="true" {% if filters[less_str] == 'true' %} checked {% endif %}> {{i}} or less</label>
                <input type="hidden" name="{{ less_str }}" value="false">                
            {% endfor %}
            <br>
            <!-- Include trends that meet -->
            <strong><label>Include trends that meet:</label><br></strong>
            <input type="radio" name="criteria" value="all" {% if filters['criteria'] == 'all' %} checked {% endif %}>
            <label for="all_criteria">All selected criteria (month, day, type, spread, total)</label><br>
            <input type="radio" name="criteria" value="any" {% if filters['criteria'] == 'any' %} checked {% endif %}>
            <label for="any_combination">Any combination of selected criteria (month, day, type, spread, total)</label><br><br>
            <!-- Seasons Included -->
            </strong><label for="seasons">Seasons Included</label></strong>
            <select name="seasons">
                {% for i in range(2006, 2024) %}
                    {% set season_str = 'since ' ~ i ~ '-' ~ (i + 1) %}
                    <option value="since {{ i }}-{{ i + 1 }}" {% if filters['seasons'] == season_str %} selected {% endif %}>since {{ i }}-{{ i + 1 }}</option>
                {% endfor %}
            </select>
            <br>
            <!-- Total Games -->
            Total Games
            <select name="gle-total-games">
                <option value="gt" {% if filters['gle_total_games'] == 'gt' %} selected {% endif %}>></option>
                <option value="gte" {% if filters['gle_total_games'] == 'gte' %} selected {% endif %}>>=</option>
                <option value="eq" {% if filters['gle_total_games'] == 'eq' %} selected {% endif %}>=</option>
                <option value="lte" {% if filters['gle_total_games'] == 'lte' %} selected {% endif %}><=</option>
                <option value="lt" {% if filters['gle_total_games'] == 'lt' %} selected {% endif %}><</option>
            </select>    
            <input type="text" name="total-games" value="{{ filters['total_games'] }}"">
            <br>
            <!-- Win % -->
            Win %
            <select name="gle-win-pct">
                <option value="gt" {% if filters['gle_win_pct'] == 'gt' %} selected {% endif %}>></option>
                <option value="gte" {% if filters['gle_win_pct'] == 'gte' %} selected {% endif %}>>=</option>
                <option value="eq" {% if filters['gle_win_pct'] == 'eq' %} selected {% endif %}>=</option>
                <option value="lte" {% if filters['gle_win_pct'] == 'lte' %} selected {% endif %}><=</option>
                <option value="lt" {% if filters['gle_win_pct'] == 'lt' %} selected {% endif %}><</option>
            </select>    
            <input type="text" name="win-pct" value="{{ filters['win_pct'] }}">
            <br>
            <!-- Sort Criteria -->
            <label for="first-sort-category">First Sort By</label>
            <select name="first-sort-category">
                <option value="win_percentage" {% if filters['first_sort_category'] == 'win_percentage' %} selected {% endif %}>Win %</option> 
                <option value="total_games" {% if filters['first_sort_category'] == 'total_games' %} selected {% endif %}>Total Games</option>               
            </select>
            <select name="first-sort-order">
                <option value="desc" {% if filters['first_sort_order'] == 'desc' %} selected {% endif %}>High to Low</option>
                <option value="asc" {% if filters['first_sort_order'] == 'asc' %} selected {% endif %}>Low to High</option>                
            </select>
            <br>
            <label for="second-sort-category">Second Sort By</label>
            <select name="second-sort-category">
                <option value="total_games" {% if filters['second_sort_category'] == 'total_games' %} selected {% endif %}>Total Games</option>
                <option value="win_percentage" {% if filters['second_sort_category'] == 'win_percentage' %} selected {% endif %}>Win %</option>                
            </select>
            <select name="second-sort-order">
                <option value="desc" {% if filters['second_sort_order'] == 'desc' %} selected {% endif %}>High to Low</option>
                <option value="asc" {% if filters['second_sort_order'] == 'asc' %} selected {% endif %}>Low to High</option>                
            </select>
            <br>
            <!-- Maximum Results -->
            Maximum Results:<input type="text" name="max_results" value="{{ filters['max_results'] }}"><input type="submit" value="Filter">
        </form>
    </div>
    
    <!-- Trends Table -->
    <div class="trends">
        Results: {{ trends | length }}
        <table>
            <tr>
                <th>Trend</th>
                <th>Total Games</th>
                <th>Record</th>
                <th>Win %</th>
            </tr>
            <!-- Trend Data -->
            {% for i in range(trends | length) %}
                <tr>
                    <td>{{ trends_descriptions[i] }}</td>
                    <td>{{ trends[i].total_games }}</td>
                    <td>{{ trends[i].wins }}-{{ trends[i].losses }}-{{ trends[i].pushes }}</td>
                    <td>{{ trends[i].win_pct }}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}
